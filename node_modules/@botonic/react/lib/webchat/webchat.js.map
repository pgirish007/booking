{"version":3,"sources":["../../src/webchat/webchat.jsx"],"names":["getParsedAction","botonicAction","splittedAction","split","length","undefined","JSON","parse","StyledWebchat","styled","div","props","width","height","COLORS","SOLID_WHITE","SOLID_BLACK_ALPHA_0_2","StyledTriggerButton","UserInputContainer","SOLID_BLACK_ALPHA_0_5","TextAreaContainer","FeaturesWrapper","TriggerImage","img","ErrorMessageContainer","ErrorMessage","ERROR_RED","CONCRETE_WHITE","WEBCHAT","DEFAULTS","FONT_FAMILY","DarkBackgroundMenu","SOLID_BLACK","Webchat","ref","webchatHooks","webchatState","addMessage","addMessageComponent","updateMessage","updateReplies","updateLatestInput","updateTyping","updateWebview","updateSession","updateLastRoutePath","updateHandoff","updateTheme","updateDevSettings","toggleWebchat","toggleEmojiPicker","togglePersistentMenu","toggleCoverComponent","doRenderCustomComponent","setError","setOnline","clearMessages","openWebviewT","closeWebviewT","updateLastMessageDate","setCurrentAttachment","firstUpdate","isOnline","online","currentDateString","Date","toISOString","theme","initialSession","initialDevSettings","onStateChange","getThemeProperty","customComponent","setCustomComponent","storage","localStorage","storageKey","STORAGE_KEY","botonicState","saveState","host","document","body","deviceAdapter","DeviceAdapter","saveWebchatState","messages","messagesJSON","session","lastRoutePath","devSettings","lastMessageUpdate","themeUpdates","handleAttachment","event","target","files","size","Error","MAX_ALLOWED_SIZE_MB","fileName","name","file","attachmentType","type","currentAttachment","sendAttachment","sendUserInput","input","onUserInput","user","window","_botonicInsertStyles","botonicStyle","head","appendChild","shadowDOM","cloneNode","querySelectorAll","style","textContent","includes","forEach","m","newComponent","delay","typing","message","customTypes","customMessageTypes","onInit","setTimeout","isWebchatOpen","init","behavior","server","current","openWebview","webviewComponent","params","handleSelectedEmoji","emojiObject","textArea","value","emoji","focus","closeWebview","options","userInputEnabled","payload","sendPayload","path","handleMenu","isPersistentMenuOpen","handleEmojiClick","isEmojiPickerOpen","animationsEnabled","CUSTOM_PROPERTIES","enableAnimations","persistentMenuOptions","persistentMenu","darkBackgroundMenu","getBlockInputs","rule","inputData","processedInput","preprocess","match","some","regex","test","checkBlockInput","blockInputs","Array","isArray","data","id","SENDERS","backgroundColor","SCORPION_GRAY","borderColor","padding","closeMenu","borderRadius","getCoverComponent","coverComponent","component","CoverComponent","closeCoverComponent","coverComponentProps","isCoverComponentOpen","messageComponentFromInput","messageComponent","temporaryDisplayUrl","URL","createObjectURL","mediaProps","from","src","sendInput","Object","keys","trim","updateSessionWithUser","userToUpdate","addBotResponse","response","map","r","action","_botonic_action","handoff","startsWith","isDev","setTyping","addUserMessage","updateUser","openWebchat","closeWebchat","openCoverComponent","renderCustomComponent","_customComponent","unmountCustomComponent","openWebviewApi","getMessages","getLastMessageUpdate","updateMessageInfo","msgId","messageInfo","messageToUpdate","filter","updatedMsg","ack","unsentInput","updateWebchatSettings","settings","resolveCase","prevSession","on_finish","sendText","text","INPUT","TEXT","POSTBACK","attachment","sendTextAreaText","onKeyDown","keyCode","shiftKey","preventDefault","webviewRequestContext","getString","stringId","setLocale","locale","webviewParams","defaultDelay","defaultTyping","onOpen","onClose","getTriggerImage","triggerImage","triggerButtonImage","LOGO","triggerButtonStyle","CustomTriggerButton","customTrigger","triggerButton","ROLES","TRIGGER_BUTTON","webchatMessageList","flex","webchatReplies","replies","isUserInputEnabled","enableUserInput","emojiPickerEnabled","enableEmojiPicker","attachmentsEnabled","enableAttachments","sendButtonEnabled","enableSendButton","CustomSendButton","customSendButton","CustomMenuButton","customMenuButton","ConditionalAnimation","children","scale","userInputArea","userInputStyle","onFocus","onBlur","textPlaceholder","PLACEHOLDER","e","display","fontSize","border","resize","overflow","outline","paddingLeft","fontFamily","userInputBoxStyle","join","webchatWebview","webviewStyle","mobileStyle","webview","mobileBreakpoint","right","bottom","updateWebchatDevSettings","DarkenBackground","_renderCustomComponent","WebchatComponent","ID","error","isCustomComponentRendered"],"mappings":"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","sourcesContent":["import { INPUT, isMobile, params2queryString } from '@botonic/core'\nimport { motion } from 'framer-motion'\nimport merge from 'lodash.merge'\nimport React, {\n  forwardRef,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n} from 'react'\nimport Textarea from 'react-textarea-autosize'\nimport styled, { StyleSheetManager } from 'styled-components'\nimport { useAsyncEffect } from 'use-async-effect'\nimport { v4 as uuidv4 } from 'uuid'\n\nimport { Audio, Document, Image, Text, Video } from '../components'\nimport { Handoff } from '../components/handoff'\nimport { normalizeWebchatSettings } from '../components/webchat-settings'\nimport {\n  COLORS,\n  MAX_ALLOWED_SIZE_MB,\n  ROLES,\n  SENDERS,\n  WEBCHAT,\n} from '../constants'\nimport { RequestContext, WebchatContext } from '../contexts'\nimport {\n  getFullMimeWhitelist,\n  getMediaType,\n  isAllowedSize,\n  isAudio,\n  isDocument,\n  isImage,\n  isMedia,\n  isText,\n  isVideo,\n  readDataURL,\n} from '../message-utils'\nimport { msgToBotonic } from '../msg-to-botonic'\nimport { scrollToBottom } from '../util/dom'\nimport { isDev, resolveImage } from '../util/environment'\nimport { ConditionalWrapper } from '../util/react'\nimport { deserializeRegex, stringifyWithRegexs } from '../util/regexs'\nimport {\n  _getThemeProperty,\n  getServerErrorMessage,\n  initSession,\n  shouldKeepSessionOnReload,\n} from '../util/webchat'\nimport { Attachment } from './components/attachment'\nimport { EmojiPicker, OpenedEmojiPicker } from './components/emoji-picker'\nimport {\n  OpenedPersistentMenu,\n  PersistentMenu,\n} from './components/persistent-menu'\nimport { SendButton } from './components/send-button'\nimport { TypingIndicator } from './components/typing-indicator'\nimport { DeviceAdapter } from './devices/device-adapter'\nimport { StyledWebchatHeader } from './header'\nimport {\n  useComponentWillMount,\n  usePrevious,\n  useTyping,\n  useWebchat,\n} from './hooks'\nimport { WebchatMessageList } from './message-list'\nimport { WebchatReplies } from './replies'\nimport { useStorageState } from './use-storage-state-hook'\nimport { WebviewContainer } from './webview'\n\nexport const getParsedAction = botonicAction => {\n  const splittedAction = botonicAction.split('create_case:')\n  if (splittedAction.length <= 1) return undefined\n  return JSON.parse(splittedAction[1])\n}\n\nconst StyledWebchat = styled.div`\n  position: fixed;\n  right: 20px;\n  bottom: 20px;\n  width: ${props => props.width}px;\n  height: ${props => props.height}px;\n  margin: auto;\n  background-color: ${COLORS.SOLID_WHITE};\n  border-radius: 10px;\n  box-shadow: ${COLORS.SOLID_BLACK_ALPHA_0_2} 0px 0px 12px;\n  display: flex;\n  flex-direction: column;\n`\n\nconst StyledTriggerButton = styled.div`\n  cursor: pointer;\n  position: fixed;\n  background: ${COLORS.SOLID_WHITE};\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  overflow: hidden;\n  width: 65px;\n  height: 65px;\n  bottom: 20px;\n  right: 10px;\n  padding: 8px;\n`\n\nconst UserInputContainer = styled.div`\n  min-height: 52px;\n  display: flex;\n  position: relative;\n  border-top: 1px solid ${COLORS.SOLID_BLACK_ALPHA_0_5};\n`\n\nconst TextAreaContainer = styled.div`\n  display: flex;\n  flex: 1 1 auto;\n  align-items: center;\n`\n\nconst FeaturesWrapper = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1;\n`\n\nconst TriggerImage = styled.img`\n  max-width: 100%;\n  max-height: 100%;\n`\n\nconst ErrorMessageContainer = styled.div`\n  position: relative;\n  display: flex;\n  z-index: 1;\n  justify-content: center;\n  width: 100%;\n`\n\nconst ErrorMessage = styled.div`\n  position: absolute;\n  top: 10px;\n  font-size: 14px;\n  line-height: 20px;\n  padding: 4px 11px;\n  display: flex;\n  background-color: ${COLORS.ERROR_RED};\n  color: ${COLORS.CONCRETE_WHITE};\n  border-radius: 5px;\n  align-items: center;\n  justify-content: center;\n  font-family: ${WEBCHAT.DEFAULTS.FONT_FAMILY};\n`\n\nconst DarkBackgroundMenu = styled.div`\n  background: ${COLORS.SOLID_BLACK};\n  opacity: 0.3;\n  z-index: 1;\n  right: 0;\n  bottom: 0;\n  border-radius: 10px;\n  position: absolute;\n  width: 100%;\n  height: 100%;\n`\n\n// eslint-disable-next-line complexity\nexport const Webchat = forwardRef((props, ref) => {\n  const {\n    webchatState,\n    addMessage,\n    addMessageComponent,\n    updateMessage,\n    updateReplies,\n    updateLatestInput,\n    updateTyping,\n    updateWebview,\n    updateSession,\n    updateLastRoutePath,\n    updateHandoff,\n    updateTheme,\n    updateDevSettings,\n    toggleWebchat,\n    toggleEmojiPicker,\n    togglePersistentMenu,\n    toggleCoverComponent,\n    doRenderCustomComponent,\n    setError,\n    setOnline,\n    clearMessages,\n    openWebviewT,\n    closeWebviewT,\n    updateLastMessageDate,\n    setCurrentAttachment,\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n  } = props.webchatHooks || useWebchat()\n  const firstUpdate = useRef(true)\n  const isOnline = () => webchatState.online\n  const currentDateString = () => new Date().toISOString()\n  const theme = merge(webchatState.theme, props.theme)\n  const { initialSession, initialDevSettings, onStateChange } = props\n  const getThemeProperty = _getThemeProperty(theme)\n\n  const [customComponent, setCustomComponent] = useState(null)\n  const storage = props.storage === undefined ? localStorage : props.storage\n  const storageKey =\n    typeof props.storageKey === 'function'\n      ? props.storageKey()\n      : props.storageKey\n\n  const [botonicState, saveState] = useStorageState(\n    storage,\n    storageKey || WEBCHAT.DEFAULTS.STORAGE_KEY\n  )\n\n  const host = props.host || document.body\n\n  const deviceAdapter = new DeviceAdapter()\n\n  const saveWebchatState = webchatState => {\n    storage &&\n      saveState(\n        JSON.parse(\n          stringifyWithRegexs({\n            messages: webchatState.messagesJSON,\n            session: webchatState.session,\n            lastRoutePath: webchatState.lastRoutePath,\n            devSettings: webchatState.devSettings,\n            lastMessageUpdate: webchatState.lastMessageUpdate,\n            themeUpdates: webchatState.themeUpdates,\n          })\n        )\n      )\n  }\n\n  const handleAttachment = event => {\n    if (!isAllowedSize(event.target.files[0].size)) {\n      throw new Error(\n        `The file is too large. A maximum of ${MAX_ALLOWED_SIZE_MB}MB is allowed.`\n      )\n    }\n    setCurrentAttachment({\n      fileName: event.target.files[0].name,\n      file: event.target.files[0], // TODO: Attach more files?\n      attachmentType: getMediaType(event.target.files[0].type),\n    })\n  }\n\n  useEffect(() => {\n    if (webchatState.currentAttachment)\n      sendAttachment(webchatState.currentAttachment)\n  }, [webchatState.currentAttachment])\n\n  const sendUserInput = async input => {\n    props.onUserInput &&\n      props.onUserInput({\n        user: webchatState.session.user,\n        input: input,\n        session: webchatState.session,\n        lastRoutePath: webchatState.lastRoutePath,\n      })\n  }\n\n  // Load styles stored in window._botonicInsertStyles by Webpack\n  useComponentWillMount(() => {\n    if (window._botonicInsertStyles && window._botonicInsertStyles.length) {\n      for (const botonicStyle of window._botonicInsertStyles) {\n        // Injecting styles at head is needed even if we use shadowDOM\n        // as some dependencies like simplebar rely on creating ephemeral elements\n        // on document.body and assume styles will be available globally\n        document.head.appendChild(botonicStyle)\n\n        // injecting styles in host node too so that shadowDOM works\n        if (props.shadowDOM) host.appendChild(botonicStyle.cloneNode(true))\n      }\n      delete window._botonicInsertStyles\n    }\n\n    if (props.shadowDOM) {\n      // emoji-picker-react injects styles in head, so we need to\n      // re-inject them in our host node to make it work with shadowDOM\n      for (const style of document.querySelectorAll('style')) {\n        if (\n          style.textContent &&\n          style.textContent.includes('emoji-picker-react')\n        )\n          host.appendChild(style.cloneNode(true))\n      }\n    }\n  })\n\n  // Load initial state from storage\n  useEffect(() => {\n    let {\n      messages,\n      session,\n      lastRoutePath,\n      devSettings,\n      lastMessageUpdate,\n      themeUpdates,\n    } = botonicState || {}\n    session = initSession(session)\n    updateSession(session)\n    if (shouldKeepSessionOnReload({ initialDevSettings, devSettings })) {\n      if (messages) {\n        messages.forEach(m => {\n          addMessage(m)\n          const newComponent = msgToBotonic(\n            { ...m, delay: 0, typing: 0 },\n            (props.theme.message && props.theme.message.customTypes) ||\n              props.theme.customMessageTypes\n          )\n          if (newComponent) addMessageComponent(newComponent)\n        })\n      }\n      if (initialSession) updateSession(merge(initialSession, session))\n      if (lastRoutePath) updateLastRoutePath(lastRoutePath)\n    } else updateSession(merge(initialSession, session))\n    if (devSettings) updateDevSettings(devSettings)\n    else if (initialDevSettings) updateDevSettings(initialDevSettings)\n    if (lastMessageUpdate) updateLastMessageDate(lastMessageUpdate)\n    if (themeUpdates !== undefined)\n      updateTheme(merge(props.theme, themeUpdates), themeUpdates)\n    if (props.onInit) setTimeout(() => props.onInit(), 100)\n  }, [])\n\n  useEffect(() => {\n    if (!webchatState.isWebchatOpen) return\n    deviceAdapter.init(host)\n    scrollToBottom({ behavior: 'auto', host })\n  }, [webchatState.isWebchatOpen])\n\n  useEffect(() => {\n    if (onStateChange && typeof onStateChange === 'function')\n      onStateChange(webchatState)\n    saveWebchatState(webchatState)\n  }, [\n    webchatState.messagesJSON,\n    webchatState.session,\n    webchatState.lastRoutePath,\n    webchatState.devSettings,\n    webchatState.lastMessageUpdate,\n  ])\n\n  useAsyncEffect(async () => {\n    if (!webchatState.online) {\n      setError({\n        message: getServerErrorMessage(props.server),\n      })\n    } else {\n      if (!firstUpdate.current) {\n        setError(undefined)\n      }\n    }\n  }, [webchatState.online])\n\n  useTyping({ webchatState, updateTyping, updateMessage, host })\n\n  useEffect(() => {\n    updateTheme(merge(props.theme, theme, webchatState.themeUpdates))\n  }, [props.theme, webchatState.themeUpdates])\n\n  const openWebview = (webviewComponent, params) =>\n    updateWebview(webviewComponent, params)\n\n  const handleSelectedEmoji = (event, emojiObject) => {\n    textArea.current.value += emojiObject.emoji\n    textArea.current.focus()\n  }\n\n  const closeWebview = options => {\n    updateWebview()\n    if (userInputEnabled) {\n      textArea.current.focus()\n    }\n    if (options && options.payload) {\n      sendPayload(options.payload)\n    } else if (options && options.path) {\n      let params = ''\n      if (options.params) params = params2queryString(options.params)\n      sendPayload(`__PATH_PAYLOAD__${options.path}?${params}`)\n    }\n  }\n\n  const handleMenu = () => {\n    togglePersistentMenu(!webchatState.isPersistentMenuOpen)\n  }\n\n  const handleEmojiClick = () => {\n    toggleEmojiPicker(!webchatState.isEmojiPickerOpen)\n  }\n\n  const animationsEnabled = getThemeProperty(\n    WEBCHAT.CUSTOM_PROPERTIES.enableAnimations,\n    props.enableAnimations !== undefined ? props.enableAnimations : true\n  )\n  const persistentMenuOptions = getThemeProperty(\n    WEBCHAT.CUSTOM_PROPERTIES.persistentMenu,\n    props.persistentMenu\n  )\n\n  const darkBackgroundMenu = getThemeProperty(\n    WEBCHAT.CUSTOM_PROPERTIES.darkBackgroundMenu,\n    false\n  )\n\n  const getBlockInputs = (rule, inputData) => {\n    const processedInput = rule.preprocess\n      ? rule.preprocess(inputData)\n      : inputData\n\n    return rule.match.some(regex => {\n      if (typeof regex === 'string') regex = deserializeRegex(regex)\n      return regex.test(processedInput)\n    })\n  }\n\n  const checkBlockInput = input => {\n    // if is a text we check if it is a serialized RE\n    const blockInputs = getThemeProperty(\n      WEBCHAT.CUSTOM_PROPERTIES.blockInputs,\n      props.blockInputs\n    )\n    if (!Array.isArray(blockInputs)) return false\n    for (const rule of blockInputs) {\n      if (getBlockInputs(rule, input.data)) {\n        addMessageComponent(\n          <Text\n            id={input.id}\n            from={SENDERS.user}\n            blob={false}\n            style={{\n              backgroundColor: COLORS.SCORPION_GRAY,\n              borderColor: COLORS.SCORPION_GRAY,\n              padding: '8px 12px',\n            }}\n          >\n            {rule.message}\n          </Text>\n        )\n        updateReplies(false)\n        return true\n      }\n    }\n    return false\n  }\n  const closeMenu = () => {\n    togglePersistentMenu(false)\n  }\n\n  const persistentMenu = () => {\n    return (\n      <OpenedPersistentMenu\n        onClick={closeMenu}\n        options={persistentMenuOptions}\n        borderRadius={webchatState.theme.style.borderRadius || '10px'}\n      />\n    )\n  }\n\n  const getCoverComponent = () => {\n    return getThemeProperty(\n      WEBCHAT.CUSTOM_PROPERTIES.coverComponent,\n      props.coverComponent &&\n        (props.coverComponent.component || props.coverComponent)\n    )\n  }\n  const CoverComponent = getCoverComponent()\n\n  const closeCoverComponent = () => {\n    toggleCoverComponent(false)\n  }\n\n  useEffect(() => {\n    if (!CoverComponent) return\n    if (\n      !botonicState ||\n      (botonicState.messages && botonicState.messages.length == 0)\n    )\n      toggleCoverComponent(true)\n  }, [])\n\n  const coverComponent = () => {\n    const coverComponentProps = getThemeProperty(\n      WEBCHAT.CUSTOM_PROPERTIES.coverComponentProps,\n      props.coverComponent && props.coverComponent.props\n    )\n\n    if (CoverComponent && webchatState.isCoverComponentOpen)\n      return (\n        <CoverComponent\n          closeComponent={closeCoverComponent}\n          {...coverComponentProps}\n        />\n      )\n    return null\n  }\n\n  const messageComponentFromInput = input => {\n    let messageComponent = null\n    if (isText(input)) {\n      messageComponent = (\n        <Text id={input.id} payload={input.payload} from={SENDERS.user}>\n          {input.data}\n        </Text>\n      )\n    } else if (isMedia(input)) {\n      const temporaryDisplayUrl = URL.createObjectURL(input.data)\n      const mediaProps = {\n        id: input.id,\n        from: SENDERS.user,\n        src: temporaryDisplayUrl,\n      }\n      if (isImage(input)) messageComponent = <Image {...mediaProps} />\n      else if (isAudio(input)) messageComponent = <Audio {...mediaProps} />\n      else if (isVideo(input)) messageComponent = <Video {...mediaProps} />\n      else if (isDocument(input))\n        messageComponent = <Document {...mediaProps} />\n    }\n    return messageComponent\n  }\n\n  const sendInput = async input => {\n    if (!input || Object.keys(input).length == 0) return\n    if (isText(input) && (!input.data || !input.data.trim())) return // in case trim() doesn't work in a browser we can use !/\\S/.test(input.data)\n    if (isText(input) && checkBlockInput(input)) return\n    if (!input.id) input.id = uuidv4()\n    const messageComponent = messageComponentFromInput(input)\n    if (messageComponent) addMessageComponent(messageComponent)\n    if (isMedia(input)) input.data = await readDataURL(input.data)\n    sendUserInput(input)\n    updateLatestInput(input)\n    isOnline() && updateLastMessageDate(currentDateString())\n    updateReplies(false)\n    togglePersistentMenu(false)\n    toggleEmojiPicker(false)\n  }\n\n  /* This is the public API this component exposes to its parents\n  https://stackoverflow.com/questions/37949981/call-child-method-from-parent\n  */\n\n  const updateSessionWithUser = userToUpdate =>\n    updateSession(merge(webchatState.session, { user: userToUpdate }))\n\n  useImperativeHandle(ref, () => ({\n    addBotResponse: ({ response, session, lastRoutePath }) => {\n      updateTyping(false)\n      if (Array.isArray(response)) response.map(r => addMessageComponent(r))\n      else if (response) addMessageComponent(response)\n      if (session) {\n        updateSession(merge(session, { user: webchatState.session.user }))\n        const action = session._botonic_action || ''\n        const handoff = action.startsWith('create_case')\n        if (handoff && isDev) addMessageComponent(<Handoff />)\n        updateHandoff(handoff)\n      }\n      if (lastRoutePath) updateLastRoutePath(lastRoutePath)\n      updateLastMessageDate(currentDateString())\n    },\n    setTyping: typing => updateTyping(typing),\n    addUserMessage: message => sendInput(message),\n    updateUser: updateSessionWithUser,\n    openWebchat: () => toggleWebchat(true),\n    closeWebchat: () => toggleWebchat(false),\n    toggleWebchat: () => toggleWebchat(!webchatState.isWebchatOpen),\n    openCoverComponent: () => toggleCoverComponent(true),\n    closeCoverComponent: () => toggleCoverComponent(false),\n    renderCustomComponent: _customComponent => {\n      setCustomComponent(_customComponent)\n      doRenderCustomComponent(true)\n    },\n    unmountCustomComponent: () => doRenderCustomComponent(false),\n    toggleCoverComponent: () =>\n      toggleCoverComponent(!webchatState.isCoverComponentOpen),\n    openWebviewApi: component => openWebviewT(component),\n    setError,\n    setOnline,\n    getMessages: () => webchatState.messagesJSON,\n    isOnline,\n    clearMessages: () => {\n      clearMessages()\n      updateReplies(false)\n    },\n    getLastMessageUpdate: () => webchatState.lastMessageUpdate,\n    updateMessageInfo: (msgId, messageInfo) => {\n      const messageToUpdate = webchatState.messagesJSON.filter(\n        m => m.id == msgId\n      )[0]\n      const updatedMsg = merge(messageToUpdate, messageInfo)\n      if (updatedMsg.ack === 1) delete updatedMsg.unsentInput\n      updateMessage(updatedMsg)\n    },\n    updateWebchatSettings: settings => {\n      const themeUpdates = normalizeWebchatSettings(settings)\n      updateTheme(merge(webchatState.theme, themeUpdates), themeUpdates)\n    },\n  }))\n\n  const resolveCase = () => {\n    updateHandoff(false)\n    updateSession({ ...webchatState.session, _botonic_action: null })\n  }\n\n  const prevSession = usePrevious(webchatState.session)\n  useEffect(() => {\n    // Resume conversation after handoff\n    if (\n      prevSession &&\n      prevSession._botonic_action &&\n      !webchatState.session._botonic_action\n    ) {\n      const action = getParsedAction(prevSession._botonic_action)\n      if (action && action.on_finish) sendPayload(action.on_finish)\n    }\n  }, [webchatState.session._botonic_action])\n\n  const sendText = async (text, payload) => {\n    if (!text) return\n    const input = { type: INPUT.TEXT, data: text, payload }\n    await sendInput(input)\n  }\n\n  const sendPayload = async payload => {\n    if (!payload) return\n    const input = { type: INPUT.POSTBACK, payload }\n    await sendInput(input)\n  }\n\n  const sendAttachment = async attachment => {\n    if (attachment.file) {\n      const attachmentType = getMediaType(attachment.file.type)\n      if (!attachmentType) return\n      const input = {\n        type: attachmentType,\n        data: attachment.file,\n      }\n      await sendInput(input)\n      setCurrentAttachment(undefined)\n    }\n  }\n\n  const sendTextAreaText = () => {\n    sendText(textArea.current.value)\n    textArea.current.value = ''\n  }\n\n  const onKeyDown = event => {\n    if (event.keyCode == 13 && event.shiftKey == false) {\n      event.preventDefault()\n      sendTextAreaText()\n    }\n  }\n\n  const webviewRequestContext = {\n    getString: stringId => props.getString(stringId, webchatState.session),\n    setLocale: locale => props.getString(locale, webchatState.session),\n    session: webchatState.session || {},\n    params: webchatState.webviewParams || {},\n    closeWebview: closeWebview,\n    defaultDelay: props.defaultDelay || 0,\n    defaultTyping: props.defaultTyping || 0,\n  }\n\n  useEffect(() => {\n    if (firstUpdate.current) {\n      firstUpdate.current = false\n      return\n    }\n    if (webchatState.isWebchatOpen && props.onOpen) props.onOpen()\n    if (!webchatState.isWebchatOpen && props.onClose && !firstUpdate.current) {\n      props.onClose()\n      toggleEmojiPicker(false)\n      togglePersistentMenu(false)\n    }\n  }, [webchatState.isWebchatOpen])\n\n  const textArea = useRef()\n\n  const getTriggerImage = () => {\n    const triggerImage = getThemeProperty(\n      WEBCHAT.CUSTOM_PROPERTIES.triggerButtonImage,\n      null\n    )\n    if (triggerImage === null) {\n      webchatState.theme.triggerButtonImage = WEBCHAT.DEFAULTS.LOGO\n      return null\n    }\n    return triggerImage\n  }\n\n  const triggerButtonStyle = getThemeProperty(\n    WEBCHAT.CUSTOM_PROPERTIES.triggerButtonStyle\n  )\n\n  const CustomTriggerButton = getThemeProperty(\n    WEBCHAT.CUSTOM_PROPERTIES.customTrigger,\n    undefined\n  )\n\n  const triggerButton = () => {\n    if (CustomTriggerButton) {\n      return <CustomTriggerButton />\n    }\n    return (\n      <StyledTriggerButton\n        role={ROLES.TRIGGER_BUTTON}\n        style={{ ...triggerButtonStyle }}\n      >\n        {getTriggerImage() && (\n          <TriggerImage src={resolveImage(getTriggerImage())} />\n        )}\n      </StyledTriggerButton>\n    )\n  }\n\n  const webchatMessageList = () => (\n    <WebchatMessageList style={{ flex: 1 }}>\n      {webchatState.typing && <TypingIndicator />}\n    </WebchatMessageList>\n  )\n  const webchatReplies = () => <WebchatReplies replies={webchatState.replies} />\n\n  const isUserInputEnabled = () => {\n    const isUserInputEnabled = getThemeProperty(\n      WEBCHAT.CUSTOM_PROPERTIES.enableUserInput,\n      props.enableUserInput !== undefined ? props.enableUserInput : true\n    )\n    return isUserInputEnabled && !webchatState.isCoverComponentOpen\n  }\n\n  const userInputEnabled = isUserInputEnabled()\n  const emojiPickerEnabled = getThemeProperty(\n    WEBCHAT.CUSTOM_PROPERTIES.enableEmojiPicker,\n    props.enableEmojiPicker\n  )\n  const attachmentsEnabled = getThemeProperty(\n    WEBCHAT.CUSTOM_PROPERTIES.enableAttachments,\n    props.enableAttachments\n  )\n  const sendButtonEnabled = getThemeProperty(\n    WEBCHAT.CUSTOM_PROPERTIES.enableSendButton,\n    true\n  )\n  const CustomSendButton = getThemeProperty(\n    WEBCHAT.CUSTOM_PROPERTIES.customSendButton,\n    undefined\n  )\n  const CustomMenuButton = getThemeProperty(\n    WEBCHAT.CUSTOM_PROPERTIES.customMenuButton,\n    undefined\n  )\n\n  const ConditionalAnimation = props => (\n    <ConditionalWrapper\n      condition={animationsEnabled}\n      wrapper={children => (\n        <motion.div whileHover={{ scale: 1.2 }}>{children}</motion.div>\n      )}\n    >\n      {props.children}\n    </ConditionalWrapper>\n  )\n\n  const userInputArea = () => {\n    return (\n      userInputEnabled && (\n        <UserInputContainer\n          style={{\n            ...getThemeProperty(WEBCHAT.CUSTOM_PROPERTIES.userInputStyle),\n          }}\n        >\n          {webchatState.isEmojiPickerOpen && (\n            <OpenedEmojiPicker\n              height={webchatState.theme.style.height}\n              onEmojiClick={handleSelectedEmoji}\n              onClick={handleEmojiClick}\n            />\n          )}\n          {persistentMenuOptions && (\n            <FeaturesWrapper>\n              <ConditionalAnimation>\n                <div onClick={handleMenu}>\n                  {CustomMenuButton ? <CustomMenuButton /> : <PersistentMenu />}\n                </div>\n              </ConditionalAnimation>\n            </FeaturesWrapper>\n          )}\n          <TextAreaContainer>\n            <Textarea\n              name='text'\n              onFocus={() => deviceAdapter.onFocus(host)}\n              onBlur={() => deviceAdapter.onBlur()}\n              maxRows={4}\n              wrap='soft'\n              maxLength='1000'\n              placeholder={getThemeProperty(\n                WEBCHAT.CUSTOM_PROPERTIES.textPlaceholder,\n                WEBCHAT.DEFAULTS.PLACEHOLDER\n              )}\n              autoFocus={true}\n              inputRef={textArea}\n              onKeyDown={e => onKeyDown(e)}\n              style={{\n                display: 'flex',\n                fontSize: deviceAdapter.fontSize(14),\n                width: '100%',\n                border: 'none',\n                resize: 'none',\n                overflow: 'auto',\n                outline: 'none',\n                flex: '1 1 auto',\n                padding: 10,\n                paddingLeft: persistentMenuOptions ? 0 : 10,\n                fontFamily: 'inherit',\n                ...getThemeProperty(\n                  WEBCHAT.CUSTOM_PROPERTIES.userInputBoxStyle\n                ),\n              }}\n            />\n          </TextAreaContainer>\n          <FeaturesWrapper>\n            {emojiPickerEnabled && (\n              <ConditionalAnimation>\n                <EmojiPicker onClick={handleEmojiClick} />\n              </ConditionalAnimation>\n            )}\n            {attachmentsEnabled && (\n              <ConditionalAnimation>\n                <Attachment\n                  onChange={handleAttachment}\n                  accept={getFullMimeWhitelist().join(',')}\n                />\n              </ConditionalAnimation>\n            )}\n            {(sendButtonEnabled || CustomSendButton) && (\n              <ConditionalAnimation>\n                <div onClick={sendTextAreaText}>\n                  {CustomSendButton ? <CustomSendButton /> : <SendButton />}\n                </div>\n              </ConditionalAnimation>\n            )}\n          </FeaturesWrapper>\n        </UserInputContainer>\n      )\n    )\n  }\n\n  const webchatWebview = () => (\n    <RequestContext.Provider value={webviewRequestContext}>\n      <WebviewContainer\n        style={{\n          ...getThemeProperty(WEBCHAT.CUSTOM_PROPERTIES.webviewStyle),\n          ...mobileStyle,\n        }}\n        webview={webchatState.webview}\n      />\n    </RequestContext.Provider>\n  )\n  let mobileStyle = {}\n  if (isMobile(getThemeProperty(WEBCHAT.CUSTOM_PROPERTIES.mobileBreakpoint))) {\n    mobileStyle = getThemeProperty(WEBCHAT.CUSTOM_PROPERTIES.mobileStyle) || {\n      width: '100%',\n      height: '100%',\n      right: 0,\n      bottom: 0,\n      borderRadius: 0,\n    }\n  }\n\n  useEffect(() => {\n    // Prod mode\n    saveWebchatState(webchatState)\n    scrollToBottom({ host })\n  }, [webchatState.themeUpdates])\n\n  // Only needed for dev/serve mode\n  const updateWebchatDevSettings = settings => {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    useEffect(() => {\n      const themeUpdates = normalizeWebchatSettings(settings)\n      updateTheme(merge(webchatState.theme, themeUpdates), themeUpdates)\n    }, [webchatState.messagesJSON])\n  }\n\n  const DarkenBackground = ({ component }) => {\n    return (\n      <div>\n        {darkBackgroundMenu && (\n          <DarkBackgroundMenu\n            style={{\n              borderRadius: webchatState.theme.style.borderRadius,\n            }}\n          />\n        )}\n        {component}\n      </div>\n    )\n  }\n\n  const _renderCustomComponent = () => {\n    if (!customComponent) return <></>\n    else return customComponent\n  }\n\n  const WebchatComponent = (\n    <WebchatContext.Provider\n      value={{\n        sendText,\n        sendAttachment,\n        sendPayload,\n        sendInput,\n        openWebview,\n        resolveCase,\n        webchatState,\n        getThemeProperty,\n        addMessage,\n        toggleWebchat,\n        updateMessage,\n        updateReplies,\n        updateLatestInput,\n        updateUser: updateSessionWithUser,\n        updateWebchatDevSettings: updateWebchatDevSettings,\n      }}\n    >\n      {!webchatState.isWebchatOpen && (\n        <div\n          onClick={event => {\n            toggleWebchat(true)\n            event.preventDefault()\n          }}\n        >\n          {triggerButton()}\n        </div>\n      )}\n\n      {webchatState.isWebchatOpen && (\n        <StyledWebchat\n          // TODO: Distinguis between multiple instances of webchat, e.g. `${uniqueId}-botonic-webchat`\n          role={ROLES.WEBCHAT}\n          id={WEBCHAT.DEFAULTS.ID}\n          width={webchatState.width}\n          height={webchatState.height}\n          style={{\n            ...webchatState.theme.style,\n            ...mobileStyle,\n          }}\n        >\n          <StyledWebchatHeader\n            onCloseClick={() => {\n              toggleWebchat(false)\n            }}\n          />\n          {webchatState.error.message && (\n            <ErrorMessageContainer>\n              <ErrorMessage>{webchatState.error.message}</ErrorMessage>\n            </ErrorMessageContainer>\n          )}\n          {webchatMessageList()}\n          {webchatState.replies &&\n            Object.keys(webchatState.replies).length > 0 &&\n            webchatReplies()}\n          {webchatState.isPersistentMenuOpen && (\n            <DarkenBackground component={persistentMenu()} />\n          )}\n          {!webchatState.handoff && userInputArea()}\n          {webchatState.webview && webchatWebview()}\n          {webchatState.isCoverComponentOpen && coverComponent()}\n          {webchatState.isCustomComponentRendered &&\n            customComponent &&\n            _renderCustomComponent()}\n        </StyledWebchat>\n      )}\n    </WebchatContext.Provider>\n  )\n  return props.shadowDOM ? (\n    <StyleSheetManager target={host}>{WebchatComponent}</StyleSheetManager>\n  ) : (\n    WebchatComponent\n  )\n})\n"],"file":"webchat.js"}